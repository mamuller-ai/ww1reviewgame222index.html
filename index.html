<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WWI Defense Command</title>
<style>
body{
    background:#111;
    color:white;
    font-family:Arial;
    text-align:center;
}
h1{margin-bottom:5px;}

#stats{
    margin:10px;
    font-size:18px;
}

#map{
    width:900px;
    height:450px;
    margin:auto;
    position:relative;
    border:4px solid white;
    background-image:url('https://upload.wikimedia.org/wikipedia/commons/3/38/Europe_1914_map_en.png');
    background-size:cover;
    overflow:hidden;
    cursor:crosshair;
}

.enemy{
    width:24px;
    height:24px;
    background:red;
    border-radius:50%;
    position:absolute;
}

.tower{
    width:30px;
    height:30px;
    background:limegreen;
    position:absolute;
    border-radius:5px;
}

button{
    padding:10px;
    margin:5px;
    font-size:15px;
}

#questionBox{
    margin-top:15px;
}
</style>
</head>
<body>

<h1>WWI Defense Command</h1>

<div id="stats">
Health: <span id="health">100</span> |
Resources: <span id="resources">0</span> |
Wave: <span id="wave">1</span> |
Questions: <span id="answered">0</span>/50
</div>

<div id="map"></div>

<div id="questionBox">
<h3 id="question">Answer correctly to earn defenses!</h3>
<div id="answers"></div>
</div>

<script>
let health = 100;
let resources = 0;
let wave = 1;
let answered = 0;
let towers = [];
let enemies = [];
let gameActive = true;

// Example questions
const questions=[
{q:"Spark of WWI?",a:["Franz Ferdinand assassination","Lusitania","Zimmerman Telegram","U-boats"],c:0},
{q:"US entered war as:",a:["Allied","Central","Neutral","Axis"],c:0},
{q:"German submarines:",a:["Tanks","Zeppelins","U-boats","Aces"],c:2},
{q:"Trench ditch fighting:",a:["Imperialism","Militarism","Sub warfare","Trench warfare"],c:3},
{q:"Government persuasion:",a:["Propaganda","Nationalism","Alliances","Imperialism"],c:0}
];

// Duplicate to reach 50
while(questions.length<50){
    questions.push(...questions.slice(0,5));
}

function updateStats(){
    document.getElementById("health").innerText = health;
    document.getElementById("resources").innerText = resources;
    document.getElementById("wave").innerText = wave;
    document.getElementById("answered").innerText = answered;
    if(health <= 0){
        alert("Central Powers Overran Europe!");
        location.reload();
    }
}

function askQuestion(){
    if(answered >= 50){
        alert("Victory! Treaty of Versailles Signed!");
        location.reload();
        return;
    }
    let q = questions[Math.floor(Math.random() * questions.length)];
    document.getElementById("question").innerText = q.q;

    let html = "";
    q.a.forEach((ans,i)=>{
        html += `<button onclick="answer(${i},${q.c})">${ans}</button>`;
    });
    document.getElementById("answers").innerHTML = html;
}

function answer(choice, correct){
    answered++;
    if(choice == correct){
        resources += 15;
    } else {
        health -= 10;
    }
    updateStats();
    askQuestion();
}

// --- Place towers ---
document.getElementById("map").addEventListener("click", function(e){
    if(resources >= 20){
        let rect = this.getBoundingClientRect();
        let tower = document.createElement("div");
        tower.className = "tower";
        tower.style.left = (e.clientX - rect.left - 15) + "px";
        tower.style.top = (e.clientY - rect.top - 15) + "px";
        tower.health = 3; // 3 hits, each reduces 33%
        this.appendChild(tower);
        towers.push(tower);
        resources -= 20;
        updateStats();
    }
});

// --- SPAWN ENEMIES WITH MULTIPLE LANES ---
const lanes = [50, 120, 200, 280, 360]; // 5 lanes

function spawnEnemy() {
    if(!gameActive) return;

    let enemy = document.createElement("div");
    enemy.className = "enemy";
    document.getElementById("map").appendChild(enemy);

    let startY = lanes[Math.floor(Math.random() * lanes.length)];
    enemy.style.top = startY + "px";
    let posX = 0;
    enemy.style.left = posX + "px";

    let speed = 2 + wave * 0.2 + Math.random();

    // Move enemy
    enemy.moveInterval = setInterval(()=>{
        posX += speed;
        enemy.style.left = posX + "px";

        // Check for tower collision
        towers.forEach(tower=>{
            if(!tower) return;
            let tx = tower.offsetLeft + 15;
            let ty = tower.offsetTop + 15;
            let ex = enemy.offsetLeft + 12;
            let ey = enemy.offsetTop + 12;
            let dist = Math.hypot(tx-ex, ty-ey);
            if(dist < 40){ // enemy hits tower
                tower.health -= 1;
                if(tower.health <= 0){
                    tower.remove();
                    towers = towers.filter(t => t!==tower);
                }
                clearInterval(enemy.moveInterval);
                enemy.remove();
                enemies = enemies.filter(e => e!==enemy);
            }
        });

        // Enemy reaches right side
        if(posX > 880){
            health -= 5;
            updateStats();
            clearInterval(enemy.moveInterval);
            enemy.remove();
            enemies = enemies.filter(e => e!==enemy);
        }

    },30);

    enemies.push(enemy);
}

// --- TOWER ATTACK ---
function towerAttack(){
    towers.forEach(tower=>{
        enemies.forEach(enemy=>{
            if(enemy && tower){
                let tx = tower.offsetLeft + 15;
                let ty = tower.offsetTop + 15;
                let ex = enemy.offsetLeft + 12;
                let ey = enemy.offsetTop + 12;
                let dist = Math.hypot(tx-ex, ty-ey);
                if(dist < 150){
                    clearInterval(enemy.moveInterval);
                    enemy.remove();
                    enemies = enemies.filter(e => e!==enemy);
                    resources += 5;
                }
            }
        });
    });
}

// --- GAME LOOP ---
setInterval(()=>{
    for(let i=0;i<2;i++){
        spawnEnemy();
    }
    wave++;
    updateStats();
},4000);

setInterval(()=>{
    towerAttack();
},800);

askQuestion();
updateStats();
</script>
</body>
</html>
